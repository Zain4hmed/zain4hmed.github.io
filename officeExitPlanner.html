<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Office Time Calculator</title>

<style>
    body {
    background-color: #121212;
    color: #e0e0e0;
    font-family: Arial, sans-serif;
    margin: 0;
    min-height: 100vh;
    background-image: url('vimal-s-GBg3jyGS-Ug-unsplash.jpg');
    background-size: cover;
    background-position: center;
    background-attachment: fixed;
    display: flex;
    justify-content: center;
}

.card {
    background-color: rgba(255, 255, 255, 0.05);
    border-radius: 12px;
    box-shadow: 0 8px 20px rgba(0, 0, 0, 0.4);
    padding: 20px;
    width: 100%;
    max-width: 650px;
    backdrop-filter: blur(5px) brightness(1.1);
    border: 1px solid rgba(255, 255, 255, 0.08);
    display: flex;
    flex-direction: column;
    gap: 20px;
    margin: 40px 0; /* add vertical spacing so you can scroll fully */
}


    .form-group {
        display: flex;
        flex-direction: column;
        gap: 5px;
    }

    input[type="number"], input[type="time"], button {
        padding: 10px;
        border-radius: 5px;
        border: 1px solid #363636;
        font-size: 16px;
        width: 100%;
        box-sizing: border-box;
    }

    input[type="number"], input[type="time"] {
        background-color: #161616;
        color: #fff;
    }

    button {
        background-color: #6200ea;
        color: #fff;
        cursor: pointer;
        transition: background-color 0.3s ease;
        border: none;
    }

    button:hover {
        background-color: #3700b3;
    }

    p {
        font-size: 18px;
        margin: 0;
        color: #e0e0e0;
    }

    label {
        color: #e0e0e0;
    }

    .container {
        background-color: rgba(30, 30, 30, 0.8);
        padding: 20px;
        border-radius: 10px;
    }

    pre {
        background: black;
        color: white;
        padding: 10px;
        border-radius: 5px;
        white-space: pre-wrap;
        word-wrap: break-word;
    }

    table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 15px;
    }

    th, td {
        border: 1px solid #444;
        padding: 8px;
        text-align: center;
    }

    th {
        background-color: #333;
    }

    tr:nth-child(even) {
        background-color: #222;
    }
</style>
</head>
<body>

<div class="card">
    <!-- Work Hours Form -->
    <div class="form-group">
        <input type="number" placeholder="Monday" id="Monday">
    </div>
    <div class="form-group">
        <input type="number" placeholder="Tuesday" id="Tuesday">
    </div>
    <div class="form-group">
        <input type="number" placeholder="Wednesday" id="Wednesday">
    </div>
    <div class="form-group">
        <input type="number" placeholder="Thursday" id="Thursday">
    </div>
    <div class="form-group">
        <input type="number" placeholder="Friday" id="Friday">
    </div>
    <div class="form-group">
        <label for="timeInput">Entry Time:</label>
        <input type="time" id="timeInput" name="timeInput">
    </div>
    <div class="form-group">
        <button onclick="calculate()">Calculate Exit Time</button>
    </div>
    <div class="form-group">
        <p id="output"></p>
    </div>

    <!-- OCR + Table -->
    <div class="container">
        <h2>Office Time Calculator (Improved OCR)</h2>
        <input type="file" id="imageUpload" accept="image/*">
        <button onclick="processImage()">Extract & Calculate</button>
        <h3>Extracted Text:</h3>
        <pre id="extractedText"></pre>
        <h3>Calculated Table:</h3>
        <table id="resultsTable">
            <thead>
                <tr>
                    <th>Date</th>
                    <th>First Entry</th>
                    <th>Last Exit</th>
                    <th>Total Hours</th>
                    <th>Hours (Decimal)</th>
                </tr>
            </thead>
            <tbody></tbody>
        </table>
    </div>
</div>

<!-- Tesseract OCR -->
<script src="https://cdn.jsdelivr.net/npm/tesseract.js@2.1.5/dist/tesseract.min.js"></script>

<script>
    function weekTimeInMins() {
        let mon = Number(document.getElementById('Monday').value) || 0;
        let tue = Number(document.getElementById('Tuesday').value) || 0;
        let wed = Number(document.getElementById('Wednesday').value) || 0;
        let thu = Number(document.getElementById('Thursday').value) || 0;
        let fri = Number(document.getElementById('Friday').value) || 0;
        return (mon + tue + wed + thu + fri) * 60;
    }

    function timeInHHMM(mins) {
        let hrs = Math.trunc(mins / 60);
        let min = mins % 60;
        return [hrs, min.toString().padStart(2, "0")];
    }

    function calculate() {
        let remainingtime = (45 * 60) - weekTimeInMins();
        let friEntrytime = document.getElementById('timeInput').value;
        let [frihrs, frimin] = friEntrytime.split(':').map(Number);
        let totalTimeInMins = (remainingtime + (frihrs * 60) + frimin) - (12 * 60);

        let exitTime = timeInHHMM(totalTimeInMins);
        let remingTime = timeInHHMM(remainingtime);
        document.getElementById('output').innerText = 
            "Exit time is " + exitTime[0] + ":" + exitTime[1] + " PM, you need to spend " + remingTime[0] + " hr " + remingTime[1] + " min in office";
    }

    function fixTimeFormat(timeStr) {
        timeStr = timeStr.replace(/\./g, ":");
        if (/^\d{3,4}$/.test(timeStr)) {
            let hrs = timeStr.slice(0, timeStr.length - 2);
            let mins = timeStr.slice(-2);
            return hrs.padStart(2, "0") + ":" + mins;
        }
        return timeStr;
    }

    function calculateHours(start, end) {
    let [sh, sm] = start.split(":").map(Number);
    let [eh, em] = end.split(":").map(Number);
    let startMins = sh * 60 + sm;
    let endMins = eh * 60 + em;
    let diff = endMins - startMins;
    if (diff < 0) diff += 24 * 60; // Handle overnight cases
    let hrs = Math.floor(diff / 60);
    let mins = diff % 60;
    return { text: `${hrs}h ${mins}m`, minutes: diff }; // Return both
}

    async function processImage() {
        let file = document.getElementById("imageUpload").files[0];
        if (!file) return alert("Please select an image!");

        document.getElementById("extractedText").textContent = "Processing...";

        let result = await Tesseract.recognize(file, 'eng', {
            logger: m => console.log(m)
        });

        let text = result.data.text;
        document.getElementById("extractedText").textContent = text;
        parseAndDisplay(text);
    }

    function parseAndDisplay(text) {
    let lines = text.split("\n").map(l => l.trim()).filter(l => l);
    let dataByDate = {};
    let currentDate = null;

    lines.forEach(line => {
        if (/^\w{3},/.test(line)) {
            currentDate = line;
            dataByDate[currentDate] = { entries: [], exits: [] };
        }
        if (currentDate) {
            if (/Entry/i.test(line)) {
                let time = fixTimeFormat(line.split(" ")[0]);
                dataByDate[currentDate].entries.push(time);
            }
            if (/Exit/i.test(line)) {
                let time = fixTimeFormat(line.split(" ")[0]);
                dataByDate[currentDate].exits.push(time);
            }
        }
    });

    let tbody = document.querySelector("#resultsTable tbody");
    tbody.innerHTML = "";
    Object.keys(dataByDate).forEach(date => {
        let firstEntry = dataByDate[date].entries[0] || "";
        let lastExit = dataByDate[date].exits[dataByDate[date].exits.length - 1] || "";
        let totalData = (firstEntry && lastExit) ? calculateHours(firstEntry, lastExit) : { text: "", minutes: 0 };
        let decimalHours = totalData.minutes ? (totalData.minutes / 60).toFixed(2) : "";
        
        let row = `<tr>
            <td>${date}</td>
            <td>${firstEntry}</td>
            <td>${lastExit}</td>
            <td>${totalData.text}</td>
            <td>${decimalHours}</td>
        </tr>`;
        tbody.innerHTML += row;
    });
}
</script>

</body>
</html>
